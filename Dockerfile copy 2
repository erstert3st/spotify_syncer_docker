FROM python:3.9-slim-buster

#Set Environment Vars for docker
ENV arl=xxx 
ENV	spot_id=x  
ENV	spot_secret=x 
ENV	spot_username=**None** 
#minute wait 
ENV	wait_time=10
    #	DiscordBotToken = **None** \ 
	#CHANNEL = **None** 
ENV CHROME_USR_DIR="/root/.config/google-chrome/"
# set display port to avoid crash
ENV DISPLAY=:99
ENV BASEBATH=/download

EXPOSE 9090
EXPOSE 5678
RUN apt-get -y update && apt-get install wget gnupg   nano unzip xvfb  -yqq

# install google chrome downlod3rmusik@gmail.com
RUN apt-get install -y wget
RUN wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \ 
    && echo "deb http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list
RUN apt-get update && apt-get -yqq install google-chrome-stable

# install chromedriver
#RUN apt-get install -yqq unzip
#RUN wget -O /tmp/chromedriver.zip http://chromedriver.storage.googleapis.com/`curl -sS chromedriver.storage.googleapis.com/LATEST_RELEASE`/chromedriver_linux64.zip
#RUN unzip /tmp/chromedriver.zip chromedriver -d /usr/local/bin/
#RUN unzip /tmp/chromedriver.zip chromedriver -d /usr/local/bin/




RUN mkdir /download
RUN mkdir /app
RUN mkdir /root/.config/spotify_sync -p

#COPY config.json /app
#COPY startup.sh /app
COPY . /app

WORKDIR /app
RUN chmod +x startup.sh
# install spot_sync from requirements 
RUN pip3 install --no-cache-dir --upgrade pip 
RUN pip3 install --no-cache-dir Poetry 
RUN poetry install
#&& pip install -U spot_sync --no-cache-dir 
#RUN pip3 install -U spot_sync --no-cache-dir 
#RUN pip3 uninstall  spot_sync  -y
RUN pip3 install . 
RUN apt clean -y
RUN pip cache purge
# cmd to run container at start
CMD ["/bin/bash", "/app/startup.sh"]
#CMD ["/bin/bash"]

# docker build  -t spotifysync:0.3.6 "." --no-cache
# docker run -it --name spotifysync --rm  -v /home/user/Schreibtisch/tempp:/root/.config/spotify_sync  spotifysync:0.3.1 
# docker run -d --name spotifysync -v /home/user/Schreibtisch/tempp:/root/.config/spotify_sync  spotifysync:0.3.1
# docker run -it name /bin/bash

#docker run  -it   spotifysync:0.4.1  -v /home/user/Schreibtisch/download:/download   -v /home/user/Schreibtisch/tempp:/root/.config/spotify_sync /bin/bash

#TODO newer Python version may alpine version
#TODO set env vars in python and remove startuo.sh